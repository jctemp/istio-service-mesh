{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome","text":"<p>This repository gives more context regarding the setup of Istio's ambient and traditional service mesh experiment. It uses the <code>book info</code> example to demonstrate the performance difference between the two service meshes. Further, it is essential to note that this is an academic example and that real environment benchmarks are necessary to understand proper behaviour. Nonetheless, the benchmark aims to show the new approach's tendencies and opportunities.</p>"},{"location":"#requirements","title":"Requirements","text":"<p>You are required to install the listed software below to run the benchmarks. See the section <code>Prerequisites</code> for more information. Feel free to skip if you have the required software installed.</p> <ul> <li>Docker Version 20.10.23</li> <li>Kubernetes CLI Version 1.26.1</li> <li>Go Version 1.19.5</li> <li>kind Version v0.17.0</li> <li>helm package manager</li> <li>k9s Version 0.27.0 (optional)</li> </ul>"},{"location":"02-sources/","title":"Sources","text":"<p>These are the source that were used to setup the service mesh.</p> <ul> <li>Ambient mesh setup</li> <li>Ambient mesh introduction</li> <li>Dashboard setup</li> <li>Solo.io performance test</li> </ul>"},{"location":"03-environment/","title":"Environment","text":"<p>Info</p> <p>Using a virtual environment can cause unexpected behaviour. Even a setup on a native OS can still cause problems that are probably correlated to the preview version. Therefore, it is interesting to see how the upcoming release of the ambient mesh looks and if it provides better support.</p> <p>We used a VPS with four cores and 8GB of RAM for the benchmark. The installed OS is Ubuntu 22.04.1, as it offers the best compatibility. Details of the VPS are listed below.</p> <pre><code>OS:     Ubuntu 22.04.1 LTS x86_64\nHost:   KVM/QEMU (Standard PC (i440FX + PIIX, 1996) \nKernel: 5.15.0-25-generic\nShell:  bash 5.1.16\nCPU:    AMD EPYC 7282 (4) @ 2.794GHz\nMemory: 377MiB / 7951MiB\n</code></pre>"},{"location":"04-prerequisites/","title":"Quick guide","text":"<p>This section is a quick guide to installing all the dependencies. The given instructions are only for Debian-based systems. Although we provided the collection of all the needed commands, we do not guarantee correctness. Therefore, consult the official websites if you need help with problems.</p>"},{"location":"04-prerequisites/#system","title":"System","text":"<p>First, we can install basic packages via the native package manager <code>apt</code>. The tools <code>docker</code> and <code>kubectl</code> need these packages to function correctly.</p> <pre><code>sudo apt -y update\nsudo apt -y install ca-certificates curl gnupg lsb-release\n</code></pre>"},{"location":"04-prerequisites/#docker","title":"Docker","text":"<p>Docker will manage the containers of the deployed cluster. The docker documentation recommends removing any existing docker installation to have the correct version.</p> <pre><code>sudo apt remove docker docker-engine docker.io containerd runc\n</code></pre> <p>The next step is to add the docker signing key to the package manager and make the native package manager aware of the docker repository.</p> <pre><code>mkdir -p /etc/apt/keyrings\ncurl -fsSL \"https://download.docker.com/linux/ubuntu/gpg\" |\nsudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\n\necho \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \"https://download.docker.com/linux/ubuntu\" \\\n$(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list &gt;/dev/null\n</code></pre> <p>Finally, the documentation explained that we must change the installation pattern if we do not want the latest version. So feel free to adapt this section to your needs.</p> <pre><code>sudo apt -y update\n\nVERSION_STRING=5:20.10.23~3-0~ubuntu-jammy\nVERSION_AVAILABLE=$(apt-cache madison docker-ce | awk '{ print $3 }')\nif echo $VERSION_AVAILABLE | grep -q \"$VERSION_STRING\"; then sudo apt -y install \\\ndocker-ce=$VERSION_STRING \\\ndocker-ce-cli=$VERSION_STRING \\\ncontainerd.io \\\ndocker-compose-plugin; else\necho \"Could not find $VERSION_STRING.\"\nfi\n</code></pre> <p>Post-installation, depending on the system, it might be necessary to add the current user to a <code>docker</code> group which will grant access to the docker socket.</p> <pre><code>sudo groupadd docker\nsudo usermod -aG docker $USER\nnewgrp docker\n</code></pre>"},{"location":"04-prerequisites/#kubectl","title":"Kubectl","text":"<p>To work with any cluster, we must install the Kubernetes command-line tool <code>kubectl</code>. The easiest method is to curl the binary, as it can ensure the same version.</p> <pre><code>VERSION=v1.26.1\n\ncurl -LO \"https://dl.k8s.io/release/$VERSION/bin/linux/amd64/kubectl\"\ncurl -LO \"https://dl.k8s.io/$VERSION/bin/linux/amd64/kubectl.sha256\"\n</code></pre> <p>Verify the downloaded executable <code>kubectl</code>.</p> <pre><code>echo \"$(cat kubectl.sha256) kubectl\" | sha256sum --check\n</code></pre> <p>Now, we can use the <code>install</code> command to add the <code>kubectl</code> executable to the local binaries path.</p> <pre><code>sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl\n</code></pre>"},{"location":"04-prerequisites/#kind","title":"Kind","text":"<p>Next, we need an environment to create a cluster. Note that you can use cloud services instead. The <code>kind</code> tool (Kubernetes in Docker) allows us to create a local cluster. Alternatives are <code>k3d</code> or <code>minikube</code>, but during testing <code>kind</code> delivered the most reliable results.</p> <p>Similar to the <code>kubectl</code> executable, we will curl the <code>kind</code> binary.</p> <pre><code>VERSION=v0.17.0\nFILE=kind-linux-amd64\n\ncurl -Lo ./$FILE \"https://github.com/kubernetes-sigs/kind/releases/download/$VERSION/$FILE\"\ncurl -Lo ./$FILE.sha256 \"https://github.com/kubernetes-sigs/kind/releases/download/$VERSION/$FILE.sha256sum\"\n</code></pre> <p>Verify the downloaded executable <code>kind</code>.</p> <pre><code>echo \"$(cat $FILE.sha256)\" | sha256sum --check\n</code></pre> <p>Now, we can use the <code>install</code> command to add the <code>kubectl</code> executable to the local binaries path.</p> <pre><code>sudo install -o root -g root -m 0755 $FILE /usr/local/bin/kind\n</code></pre>"},{"location":"04-prerequisites/#k9s","title":"k9s","text":"<p>As previously mentioned, this part is optional. The <code>k9s</code> command line interface provides comfortable tooling with an excellent cluster overview. Nonetheless, working solely with <code>kubectl</code> is sufficient. Download the binary and unpack it.</p> <pre><code>FILE=k9s_Linux_amd64.tar.gz\ncurl -LO \"https://github.com/derailed/k9s/releases/download/v0.27.0/$FILE\"\ntar -xzf $FILE\n</code></pre> <p>Finally, install it.</p> <pre><code>sudo install -o root -g root -m 0755 ./k9s /usr/local/bin/k9s\n</code></pre>"},{"location":"04-prerequisites/#helm","title":"helm","text":"<p>The last prerequisite is the helm package manager. it allows us to add Kubernetes application to our service mesh. Helm provides an installer script which make package manager available.</p> <pre><code>curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3\nchmod 700 get_helm.sh\n./get_helm.sh\n</code></pre>"},{"location":"05-clusters/","title":"Creating clusters","text":"<p>It is necessary to download a particular preview version to create a cluster with ambient mesh functionalities. The current Istio version <code>1.16.2</code> already supports the new communication protocol <code>HBONE</code>, but it does not contain the ztunnels.</p> <pre><code>FILE=\"istio-0.0.0-ambient.191fe680b52c1754ee72a06b3e0d3f9d116f2e82-linux-amd64.tar.gz\"\nURL=\"https://storage.googleapis.com/istio-build/dev/0.0.0-ambient.191fe680b52c1754ee72a06b3e0d3f9d116f2e82\"\ncurl -LO \"$URL/$FILE\"\ncurl -LO \"$URL/$FILE.sha256\"\n</code></pre> <p>Verify the downloaded preview version.</p> <pre><code>echo $(cat $FILE.sha256) | sha256sum --check\n</code></pre> <p>Unpack the compressed tarball and enter the directory.</p> <pre><code>DEST=istio-0.0.0-ambient\nmkdir $DEST &amp;&amp; tar xzf $FILE --strip-components 1 -C $DEST &amp;&amp; cd $DEST\n</code></pre> <p>Tip</p> <p>You can create a symlink to the <code>istioctl</code> executable and add it to the <code>/usr/local/bin</code> path to make it available globally. Like that you are not required to type the path to the binary.</p> <pre><code>sudo ln -s $(pwd)/bin/istioctl /usr/local/bin/istioctl\n</code></pre>"},{"location":"05-clusters/#handling-clusters","title":"Handling clusters","text":"<p>Next, we want to be able to create a cluster. Therefore, make a new file called <code>kind-cluster.yaml</code>, which contains the code below. Alternatively, we can use the version in the <code>src/kind-cluster.yaml</code>.</p> kind-cluster.yaml<pre><code>kind: Cluster\napiVersion: kind.x-k8s.io/v1alpha4\n# Identifier of the cluster\nname: cluster\n# Create three nodes\nnodes:\n- role: control-plane\n- role: worker\n- role: worker\n</code></pre> <p>The template create a cluster with three nodes in total. This provides the basis for the <code>book info</code> example. We can use the <code>kind</code> tool to create a local cluster based on the configuration file.</p> <pre><code>kind create cluster --config kind-cluster.yaml\n</code></pre> <p>After creating a cluster, we can use the <code>k9s</code> tool to browse the various components. At this point, it should be empty as only the essential services are deployed to operate the cluster with <code>k8s</code>.</p> <p>Tip</p> <p>Note that <code>kind</code> has further valuable commands to list or delete the present clusters.</p> <pre><code># list all available clusters\nkind get clusters\n\n# delete a cluster\nkind delete clusters &lt;name&gt;\n</code></pre> <p>The last step before deploying the application is to install an Istio profile in the cluster. You can list all the available profiles with <code>istioctl profile list</code>. It also should contain the ambient profile. Finally, install Istio will the following command:</p> <pre><code>istioctl install -y --set profile=ambient\n</code></pre>"},{"location":"05-clusters/#metric-observation-of-a-cluster","title":"Metric observation of a cluster","text":"<p>Ensure you have installed the Istio service mesh because otherwise this installation will fail. Next, we will add <code>Prometheus</code> and <code>Grafana</code> to the service mesh. These two add-ons aim to monitor the system's resource usage and visualise the data accordingly.</p> <pre><code>helm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\n</code></pre> <p>After we have added the prometheus repository, it is possible to install the <code>Prometheus</code> application with <code>Grafana</code>. Now, create the followig file or used the version in the <code>src/values.yaml</code>.</p> values.yaml<pre><code>alertmanager:\nenabled: false\nkubeStateMetrics:\nenabled: false\nnodeExporter:\nenabled: true prometheus:\nprometheusSpec:\nretention: 60d\ngrafana:\nimageRenderer: enabled\nhostNetwork: true\n</code></pre> <p>Finally, we can install the <code>Prometheus</code> application to the Kubernetes cluster. Note that the <code>values.yaml</code> must be in the working directory.</p> <pre><code>helm install prometheus-metrics \\\nprometheus-community/kube-prometheus-stack \\\n--namespace monitoring \\\n--version 44.3.0 \\\n--create-namespace \\\n-f values.yaml\n</code></pre> <p>Note</p> <p>Optionally, we can remove the installed observe by executing the following command.</p> <pre><code>helm uninstall prometheus-metrics --namespace monitoring\n</code></pre> <p>The <code>Grafana</code> dashboard can be exposed to the localhost with the followig command. Note that the user is <code>admin</code> and the password is <code>prom-operator</code>. Alternatively, you can use the <code>grafana</code> script in the <code>/src</code> folder.</p> <pre><code>kubectl port-forward deployment/prometheus-metrics-grafana -n monitoring 3000 &gt; /dev/null\n</code></pre> <p>Finally, you can add the following dashboard to the <code>Grafana</code> application. As the other file, it is available in GitHub repository.</p> dashboard.json<pre><code>{\"annotations\":{\"list\":[{\"builtIn\":1,\"datasource\":\"-- Grafana --\",\"enable\":true,\"hide\":true,\"iconColor\":\"rgba(0, 211, 255, 1)\",\"name\":\"Annotations &amp; Alerts\",\"target\":{\"limit\":100,\"matchAny\":false,\"tags\":[],\"type\":\"dashboard\"},\"type\":\"dashboard\"}]},\"description\":\"A dashboard to help with cost and utilisation\",\"editable\":true,\"fiscalYearStartMonth\":0,\"gnetId\":6876,\"graphTooltip\":1,\"id\":26,\"links\":[],\"liveNow\":false,\"panels\":[{\"fieldConfig\":{\"defaults\":{\"color\":{\"mode\":\"palette-classic\"},\"custom\":{\"axisLabel\":\"\",\"axisPlacement\":\"auto\",\"barAlignment\":0,\"drawStyle\":\"line\",\"fillOpacity\":0,\"gradientMode\":\"none\",\"hideFrom\":{\"legend\":false,\"tooltip\":false,\"viz\":false},\"lineInterpolation\":\"linear\",\"lineWidth\":1,\"pointSize\":5,\"scaleDistribution\":{\"type\":\"linear\"},\"showPoints\":\"auto\",\"spanNulls\":false,\"stacking\":{\"group\":\"A\",\"mode\":\"normal\"},\"thresholdsStyle\":{\"mode\":\"off\"}},\"mappings\":[],\"thresholds\":{\"mode\":\"absolute\",\"steps\":[{\"color\":\"green\",\"value\":null},{\"color\":\"red\",\"value\":80}]}},\"overrides\":[]},\"gridPos\":{\"h\":8,\"w\":12,\"x\":0,\"y\":0},\"id\":113,\"options\":{\"legend\":{\"calcs\":[\"min\",\"mean\",\"max\"],\"displayMode\":\"table\",\"placement\":\"bottom\"},\"tooltip\":{\"mode\":\"single\"}},\"pluginVersion\":\"8.3.3\",\"targets\":[{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(rate(container_cpu_usage_seconds_total{container=\\\"istio-proxy\\\"}[5m])) by (pod)\",\"format\":\"time_series\",\"hide\":false,\"instant\":false,\"interval\":\"\",\"legendFormat\":\"{{pod}}\",\"refId\":\"B\"},{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(rate(container_cpu_usage_seconds_total{container=\\\"istio-proxy\\\"}[5m]))\",\"hide\":true,\"interval\":\"\",\"legendFormat\":\"Total CPU\",\"refId\":\"A\"}],\"title\":\"Total Sidecar/Ambient CPU per pod (stacked)\",\"type\":\"timeseries\"},{\"fieldConfig\":{\"defaults\":{\"color\":{\"mode\":\"palette-classic\"},\"custom\":{\"axisLabel\":\"\",\"axisPlacement\":\"auto\",\"barAlignment\":0,\"drawStyle\":\"line\",\"fillOpacity\":0,\"gradientMode\":\"none\",\"hideFrom\":{\"legend\":false,\"tooltip\":false,\"viz\":false},\"lineInterpolation\":\"linear\",\"lineWidth\":1,\"pointSize\":5,\"scaleDistribution\":{\"type\":\"linear\"},\"showPoints\":\"auto\",\"spanNulls\":false,\"stacking\":{\"group\":\"A\",\"mode\":\"normal\"},\"thresholdsStyle\":{\"mode\":\"off\"}},\"mappings\":[],\"thresholds\":{\"mode\":\"absolute\",\"steps\":[{\"color\":\"green\",\"value\":null}]},\"unit\":\"bytes\"},\"overrides\":[]},\"gridPos\":{\"h\":8,\"w\":12,\"x\":12,\"y\":0},\"id\":114,\"options\":{\"legend\":{\"calcs\":[\"min\",\"mean\",\"max\"],\"displayMode\":\"table\",\"placement\":\"bottom\"},\"tooltip\":{\"mode\":\"single\"}},\"pluginVersion\":\"8.3.3\",\"targets\":[{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(container_memory_working_set_bytes{container=\\\"istio-proxy\\\", pod!~\\\"istio-ingressgateway-.*\\\"}) by (pod)\",\"interval\":\"\",\"legendFormat\":\"{{pod}}\",\"refId\":\"A\"},{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(container_memory_working_set_bytes{container=\\\"istio-proxy\\\", pod!~\\\"istio-ingressgateway-.*\\\"})\",\"hide\":true,\"interval\":\"\",\"legendFormat\":\"Total memory\",\"refId\":\"B\"}],\"title\":\"Total Sidecar/Ambient RAM per pod (stacked)\",\"type\":\"timeseries\"},{\"fieldConfig\":{\"defaults\":{\"color\":{\"mode\":\"palette-classic\"},\"custom\":{\"axisLabel\":\"\",\"axisPlacement\":\"auto\",\"barAlignment\":0,\"drawStyle\":\"line\",\"fillOpacity\":0,\"gradientMode\":\"none\",\"hideFrom\":{\"legend\":false,\"tooltip\":false,\"viz\":false},\"lineInterpolation\":\"linear\",\"lineWidth\":1,\"pointSize\":5,\"scaleDistribution\":{\"type\":\"linear\"},\"showPoints\":\"auto\",\"spanNulls\":false,\"stacking\":{\"group\":\"A\",\"mode\":\"none\"},\"thresholdsStyle\":{\"mode\":\"off\"}},\"mappings\":[],\"thresholds\":{\"mode\":\"absolute\",\"steps\":[{\"color\":\"green\",\"value\":null},{\"color\":\"red\",\"value\":80}]}},\"overrides\":[]},\"gridPos\":{\"h\":8,\"w\":12,\"x\":0,\"y\":8},\"id\":108,\"options\":{\"legend\":{\"calcs\":[\"max\"],\"displayMode\":\"table\",\"placement\":\"bottom\"},\"tooltip\":{\"mode\":\"single\"}},\"pluginVersion\":\"8.3.3\",\"targets\":[{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(rate(container_cpu_usage_seconds_total{container=\\\"istio-proxy\\\"}[5m])) by (pod)\",\"format\":\"time_series\",\"hide\":false,\"instant\":false,\"interval\":\"\",\"legendFormat\":\"{{pod}}\",\"refId\":\"B\"},{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(rate(container_cpu_usage_seconds_total{container=\\\"istio-proxy\\\"}[5m]))\",\"hide\":true,\"interval\":\"\",\"legendFormat\":\"Total CPU\",\"refId\":\"A\"}],\"title\":\"Total Sidecar/Ambient CPU per pod\",\"type\":\"timeseries\"},{\"fieldConfig\":{\"defaults\":{\"color\":{\"mode\":\"palette-classic\"},\"custom\":{\"axisLabel\":\"\",\"axisPlacement\":\"auto\",\"barAlignment\":0,\"drawStyle\":\"line\",\"fillOpacity\":0,\"gradientMode\":\"none\",\"hideFrom\":{\"legend\":false,\"tooltip\":false,\"viz\":false},\"lineInterpolation\":\"linear\",\"lineWidth\":1,\"pointSize\":5,\"scaleDistribution\":{\"type\":\"linear\"},\"showPoints\":\"auto\",\"spanNulls\":false,\"stacking\":{\"group\":\"A\",\"mode\":\"none\"},\"thresholdsStyle\":{\"mode\":\"off\"}},\"mappings\":[],\"thresholds\":{\"mode\":\"absolute\",\"steps\":[{\"color\":\"green\",\"value\":null}]},\"unit\":\"bytes\"},\"overrides\":[]},\"gridPos\":{\"h\":8,\"w\":12,\"x\":12,\"y\":8},\"id\":106,\"options\":{\"legend\":{\"calcs\":[\"max\"],\"displayMode\":\"table\",\"placement\":\"bottom\"},\"tooltip\":{\"mode\":\"single\"}},\"pluginVersion\":\"8.3.3\",\"targets\":[{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(container_memory_working_set_bytes{container=\\\"istio-proxy\\\", pod!~\\\"istio-ingressgateway-.*\\\"}) by (pod)\",\"interval\":\"\",\"legendFormat\":\"{{pod}}\",\"refId\":\"A\"},{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(container_memory_working_set_bytes{container=\\\"istio-proxy\\\", pod!~\\\"istio-ingressgateway-.*\\\"})\",\"hide\":true,\"interval\":\"\",\"legendFormat\":\"Total memory\",\"refId\":\"B\"}],\"title\":\"Total Sidecar/Ambient RAM per pod\",\"type\":\"timeseries\"},{\"fieldConfig\":{\"defaults\":{\"color\":{\"mode\":\"palette-classic\"},\"custom\":{\"axisLabel\":\"\",\"axisPlacement\":\"auto\",\"barAlignment\":0,\"drawStyle\":\"line\",\"fillOpacity\":0,\"gradientMode\":\"none\",\"hideFrom\":{\"legend\":false,\"tooltip\":false,\"viz\":false},\"lineInterpolation\":\"linear\",\"lineWidth\":1,\"pointSize\":5,\"scaleDistribution\":{\"type\":\"linear\"},\"showPoints\":\"auto\",\"spanNulls\":false,\"stacking\":{\"group\":\"A\",\"mode\":\"none\"},\"thresholdsStyle\":{\"mode\":\"off\"}},\"mappings\":[],\"thresholds\":{\"mode\":\"absolute\",\"steps\":[{\"color\":\"green\",\"value\":null},{\"color\":\"red\",\"value\":80}]}},\"overrides\":[]},\"gridPos\":{\"h\":8,\"w\":12,\"x\":0,\"y\":16},\"id\":111,\"options\":{\"legend\":{\"calcs\":[],\"displayMode\":\"list\",\"placement\":\"bottom\"},\"tooltip\":{\"mode\":\"single\"}},\"pluginVersion\":\"8.3.3\",\"targets\":[{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(rate(container_cpu_usage_seconds_total{container=\\\"istio-proxy\\\"}[1m]))\",\"hide\":true,\"interval\":\"\",\"legendFormat\":\"Total CPU\",\"refId\":\"A\"},{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"max_over_time(sum(rate(container_cpu_usage_seconds_total{container=\\\"istio-proxy\\\"}[5m]))[30m:1m])\",\"hide\":false,\"interval\":\"\",\"legendFormat\":\"Max over time CPU\",\"refId\":\"C\"}],\"title\":\"Max Sidecar/Ambient CPU\",\"type\":\"timeseries\"},{\"fieldConfig\":{\"defaults\":{\"color\":{\"mode\":\"palette-classic\"},\"custom\":{\"axisLabel\":\"\",\"axisPlacement\":\"auto\",\"barAlignment\":0,\"drawStyle\":\"line\",\"fillOpacity\":0,\"gradientMode\":\"none\",\"hideFrom\":{\"legend\":false,\"tooltip\":false,\"viz\":false},\"lineInterpolation\":\"linear\",\"lineWidth\":1,\"pointSize\":5,\"scaleDistribution\":{\"type\":\"linear\"},\"showPoints\":\"auto\",\"spanNulls\":false,\"stacking\":{\"group\":\"A\",\"mode\":\"none\"},\"thresholdsStyle\":{\"mode\":\"off\"}},\"mappings\":[],\"thresholds\":{\"mode\":\"absolute\",\"steps\":[{\"color\":\"green\",\"value\":null}]},\"unit\":\"bytes\"},\"overrides\":[]},\"gridPos\":{\"h\":8,\"w\":12,\"x\":12,\"y\":16},\"id\":112,\"options\":{\"legend\":{\"calcs\":[],\"displayMode\":\"list\",\"placement\":\"bottom\"},\"tooltip\":{\"mode\":\"single\"}},\"pluginVersion\":\"8.3.3\",\"targets\":[{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(container_memory_working_set_bytes{container=\\\"istio-proxy\\\", pod!~\\\"istio-ingressgateway-.*\\\"}) by (pod)\",\"hide\":true,\"interval\":\"\",\"legendFormat\":\"{{pod}}\",\"refId\":\"A\"},{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(container_memory_working_set_bytes{container=\\\"istio-proxy\\\", pod!~\\\"istio-ingressgateway-.*\\\"})\",\"hide\":true,\"interval\":\"\",\"legendFormat\":\"Total memory\",\"refId\":\"B\"},{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"max_over_time(sum(container_memory_working_set_bytes{container=\\\"istio-proxy\\\", pod!~\\\"istio-ingressgateway-.*\\\"})[30m:1m])\",\"hide\":false,\"interval\":\"\",\"legendFormat\":\"Max over time memory\",\"refId\":\"C\"}],\"title\":\"Max Sidecar/Ambient RAM\",\"type\":\"timeseries\"},{\"fieldConfig\":{\"defaults\":{\"color\":{\"mode\":\"palette-classic\"},\"custom\":{\"axisLabel\":\"\",\"axisPlacement\":\"auto\",\"barAlignment\":0,\"drawStyle\":\"line\",\"fillOpacity\":0,\"gradientMode\":\"none\",\"hideFrom\":{\"legend\":false,\"tooltip\":false,\"viz\":false},\"lineInterpolation\":\"linear\",\"lineStyle\":{\"fill\":\"solid\"},\"lineWidth\":1,\"pointSize\":5,\"scaleDistribution\":{\"type\":\"linear\"},\"showPoints\":\"auto\",\"spanNulls\":false,\"stacking\":{\"group\":\"A\",\"mode\":\"none\"},\"thresholdsStyle\":{\"mode\":\"off\"}},\"mappings\":[],\"thresholds\":{\"mode\":\"absolute\",\"steps\":[{\"color\":\"green\",\"value\":null},{\"color\":\"red\",\"value\":80}]}},\"overrides\":[]},\"gridPos\":{\"h\":8,\"w\":12,\"x\":0,\"y\":24},\"id\":104,\"options\":{\"legend\":{\"calcs\":[],\"displayMode\":\"list\",\"placement\":\"bottom\"},\"tooltip\":{\"mode\":\"single\"}},\"pluginVersion\":\"8.3.3\",\"targets\":[{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(rate(container_cpu_usage_seconds_total{namespace=~\\\"test.*\\\"}[5m]))\",\"interval\":\"\",\"legendFormat\":\"Total CPU of workloads\",\"refId\":\"A\"},{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"PBFA97CFB590B2093\"},\"exemplar\":true,\"expr\":\"sum(rate(container_cpu_usage_seconds_total{namespace=~\\\"istio-system|test.*\\\", container=\\\"istio-proxy\\\"}[5m]))\",\"hide\":false,\"instant\":false,\"interval\":\"\",\"intervalFactor\":1,\"legendFormat\":\"Total CPU of Istio data path\",\"refId\":\"B\"}],\"title\":\"Total CPU of workloads\",\"type\":\"timeseries\"},{\"fieldConfig\":{\"defaults\":{\"color\":{\"mode\":\"palette-classic\"},\"custom\":{\"axisLabel\":\"\",\"axisPlacement\":\"auto\",\"barAlignment\":0,\"drawStyle\":\"line\",\"fillOpacity\":10,\"gradientMode\":\"none\",\"hideFrom\":{\"legend\":false,\"tooltip\":false,\"viz\":false},\"lineInterpolation\":\"linear\",\"lineWidth\":1,\"pointSize\":5,\"scaleDistribution\":{\"type\":\"linear\"},\"showPoints\":\"never\",\"spanNulls\":false,\"stacking\":{\"group\":\"A\",\"mode\":\"none\"},\"thresholdsStyle\":{\"mode\":\"off\"}},\"mappings\":[],\"thresholds\":{\"mode\":\"absolute\",\"steps\":[{\"color\":\"green\",\"value\":null},{\"color\":\"red\",\"value\":80}]},\"unit\":\"bytes\"},\"overrides\":[]},\"gridPos\":{\"h\":8,\"w\":12,\"x\":12,\"y\":24},\"id\":110,\"options\":{\"legend\":{\"calcs\":[],\"displayMode\":\"list\",\"placement\":\"bottom\"},\"tooltip\":{\"mode\":\"single\"}},\"pluginVersion\":\"8.3.3\",\"targets\":[{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"Prometheus\"},\"exemplar\":true,\"expr\":\"sum(container_memory_working_set_bytes{namespace=~\\\"test.*\\\"})\",\"interval\":\"\",\"legendFormat\":\"Total memory of workloads\",\"refId\":\"A\"},{\"datasource\":{\"type\":\"prometheus\",\"uid\":\"PBFA97CFB590B2093\"},\"exemplar\":true,\"expr\":\"sum(container_memory_working_set_bytes{namespace=~\\\"istio-system|test.*\\\", container=\\\"istio-proxy\\\"})\",\"hide\":false,\"interval\":\"\",\"legendFormat\":\"Total memory of Istio datapath\",\"refId\":\"B\"}],\"title\":\"Total RAM of workloads\",\"type\":\"timeseries\"}],\"refresh\":false,\"schemaVersion\":34,\"style\":\"dark\",\"tags\":[],\"templating\":{\"list\":[]},\"time\":{\"from\":\"now-3h\",\"to\":\"now\"},\"timepicker\":{\"hidden\":false,\"refresh_intervals\":[\"5s\",\"10s\",\"30s\",\"1m\",\"5m\",\"15m\",\"30m\",\"1h\",\"2h\",\"1d\"],\"time_options\":[\"5m\",\"15m\",\"1h\",\"6h\",\"12h\",\"24h\",\"2d\",\"7d\",\"30d\"]},\"timezone\":\"utc\",\"title\":\"Istio Performance Analysis Dashboard\",\"uid\":\"croBncMVz\",\"version\":12,\"weekStart\":\"\"}\n</code></pre> <p>Reverse Proxy</p> <p>If you do not have direct access to your machine, like us, you can use a reverse proxy to expose the <code>Grafana</code> application. To do so, install the <code>nginx</code> server.</p> <pre><code>sudo apt install -y nginx\n</code></pre> <p>Next, we have to start the application and enable it, if we want to have it started after a restart. Further, print the status of the <code>nginx</code> server to check for error.</p> <pre><code>sudo systemctl start nginx\nsudo systemctl enable nginx\nsudo systemctl status nginx\n</code></pre> <p>Now, we can add a configuration file <code>grafana.conf</code> to the nginx path <code>/etc/nginx/conf.d/</code> and optionally check the syntax with <code>nginx -t</code>.</p> grafana.conf<pre><code>server {\n    listen 20000;\n\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n    location / {\n        proxy_pass http://localhost:3000/;\n    }\n}\n</code></pre> <p>Finally, restart the <code>nginx</code> server and access the <code>Grafana</code> dashboard via your browser. Don't forget to add the port!</p> <pre><code>sudo systemctl restart nginx\nsudo systemctl status nginx\n</code></pre>"},{"location":"05-clusters/#deployment-of-the-application","title":"Deployment of the application","text":"<p>For the benchmarking, we will use the <code>book info</code> example because Istio well documented references. We have below two guides the explain the deployment of the application. The traditional guide has a more detailed explaination about the <code>book info</code> example. Further, the ambient guide can be some times errorness and troubleshooting was difficult.</p> <ul> <li>traditional guide</li> <li>ambient guide</li> </ul>"},{"location":"06-benchmarks/","title":"Benchmarks","text":"<p>For the last test, we have provided some scripts in the <code>/src</code> folder that make changes to the cluster a bit easier. The first step is to add the <code>k6</code> pods to the cluster. Therefore, create a file <code>k6.yaml</code> in your current working directory and execute the following command:</p> <pre><code>kubectl apply -f k6.yaml\n</code></pre> <p>After the <code>k6</code> application is deployed in the cluster, we need to add a script file that allow us to make the stress test.</p> <pre><code>kubectl cp &lt;some-namespace&gt;/&lt;some-pod&gt;:/home/k6 /path/to/script.js\n</code></pre> <p>Finally, we can use the the other two scripts to start the last test and change the replica count for the <code>book info</code> application.</p> <ul> <li><code>stress-test</code></li> <li><code>replica-scaling</code></li> </ul>"},{"location":"06-benchmarks/#limitations","title":"Limitations","text":"<p>Measuring the metrics inside the cluster can be inaccurate or not representative as high strain on the system can be caused partially through the scraping of data. Nonetheless, for this small example it should be sufficient to deploy a pre-configured version of <code>Prometheus</code> and scape the metrics. Further, the cluster have limited resources regarding the amount of load. Accordingly, it would be necessary to re-do the expriment in a large scale environment.</p>"},{"location":"06-benchmarks/#our-results","title":"Our results","text":"<p>TODO</p>"}]}